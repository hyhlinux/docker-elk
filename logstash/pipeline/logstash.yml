# input {
# 	tcp {
# 		port => 5000
# 	}
# }
# ## Add your filters / logstash plugins configuration here

# output {
# 	elasticsearch {
# 		hosts => "elasticsearch:9200"
# 	}
# }

input {
    # tcp {
    #     port => 5000
    #     mode => "server"
    #     type => "tcp:5000"
    #     ssl_enable => false
    # }
    #redis pub
    # redis {
    #     host => "192.168.9.46"
    #     port => 6379
    #     threads => 1
    #     data_type => "pattern_channel"
    #     key => "logstash-*"
    # }
    #redis-list
    # redis {
    #     host => "192.168.9.46"
    #     port => 6379
    #     threads => 1
    #     type => "redis-data-A"
    #     data_type => "pattern_channel"
    #     key => "logstash-*"
    # }

    # redis { 
    #     # host => "192.168.9.46"
    #     host => "192.168.1.104"
    #     port => 6379
    #     threads => 1
    #     type => "db_apkpure_log"
    #     data_type => "list"
    #     # key => "apkpure:logstash_list_dl_apkpuer_log"
    #     key => "data_migrate:logstash_list_dl_apkpuer_log"
    # } 
    jdbc {
        jdbc_connection_string => "jdbc:postgresql://192.168.1.104:5432/postgres"
        jdbc_user => "postgres"
        jdbc_password => "mysecretpassword"
        type => "db_apkpure_log"
        jdbc_validate_connection => true
        jdbc_driver_library => "/usr/share/logstash/postgresql-42.1.4.jar"
        jdbc_driver_class => "org.postgresql.Driver"
        statement => "SELECT * from post_post where timestamp > '2017-09-02 00:00:00' and timestamp < '2017-09-02 23:59:59'"
    }
}

# filter {
#     grok {
#         match => ["message", "%{HTTPDATE:logdate}"]
#     }
#     date {
#         match => ["logdate", "dd/MMM/yyyy:HH:mm:ss Z"]
#     }
#     geoip {
#         source => "message"
#         fields => ["city_name", "continent_code", "country_code2", "country_code3", "country_name", "dma_code", "ip", "latitude", "longitude", "postal_code", "region_name", "timezone"]
#     }
# }

output {
    # stdout {
    #     codec => rubydebug
    # }
    # elasticsearch {
    #     hosts => ["192.168.6.13:9200", "192.168.6.12:9200"]
    #     protocol => http
    #     index => "data_test-2017-09-12"
    #     document_type => "db_apkpure_log"
    # }
    # tcp {
    #     host  => "localhost"
    #     port  => 8888
    #     codec => json_lines
    # }
    # elasticsearch {
    #     hosts => ["192.168.6.13:9200", "192.168.6.12:9200"]
    #     index => "logstash-%{+YYYY.MM.dd}"
    #     document_type => "redis-log"
    #     flush_size => 20000
    #     idle_flush_time => 10
    #     sniffing => true
    #     template_overwrite => true
    # }
    if [type] == "redis-data-A" {
        # stdout {
        #     codec => rubydebug
        # }
        # elasticsearch {
        #     hosts => ["192.168.6.13:9200", "192.168.6.12:9200"]
        #     index => "logstash-event-a-%{+YYYY.MM.dd}"
        #     document_type => "redis-loga"
        #     flush_size => 20000
        #     idle_flush_time => 10
        #     sniffing => true
        #     template_overwrite => true
        #     user => elastic
        #     password => changeme
        # }
    }else if [type] == "db_apkpure_log" {
        stdout {
            codec => rubydebug
        }
        # elasticsearch {
        #     hosts => ["loclahost:9200"]
        #     index => "migrate_data-%{+YYYY.MM.dd}"
        #     document_type => "db_apkpure_log"
        #     codec => "json"
        #     flush_size => 20000
        #     idle_flush_time => 10
        #     sniffing => true
        #     template_overwrite => true
        #     # user => elastic
        #     # password => changeme
        # }
    }else if [type] == "redis-data-local" {
        stdout {
            codec => rubydebug
        }
        # elasticsearch {
        #     hosts => ["192.168.6.13:9200"]
        #     index => "db_apkpure_log-%{+YYYY.MM.dd}"
        #     document_type => "redis-log-test"
        #     codec => "json"
        #     # protocol => "http"
        #     flush_size => 20000
        #     idle_flush_time => 10
        #     sniffing => true
        #     template_overwrite => true
        #     # user => logstash_write
        #     # password => logstash_write
        # }
    }else if [type] == "tcp:5000" {
        stdout {
            codec => rubydebug
        }
    }
}
